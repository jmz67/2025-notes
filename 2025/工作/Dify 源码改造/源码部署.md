```
cd docker
cp middleware.env.example middleware.env
```

```
docker compose -f docker-compose.middleware.yaml up -d
```

![[Pasted image 20250221161931.png]]

### 前端部署

```
pnpm install
```

不知道为什么，用这个方式才可以，这样就可以使用了。

### 后端部署

```
cp .env.example .env
```

```python
import os
import base64

random_bytes = os.urandom(42)
base64_string = base64.b64encode(random_bytes).decode('utf-8')
print(base64_string)
```

在 .env 中替换 SECRET_KEY=

```
SECRET_KEY=ndbfq29EY87WrrHJP3VzEzhXedfWJwJj9UJbGDQQR2hcOxAFUQRdvbqR
```

创建虚拟环境：

```
poetry env use 3.12
```

![[Pasted image 20250221162417.png]]

注意在 pyproject.toml 中把 chromadb 依赖项注释掉，注释掉之后就：

![[Pasted image 20250221162531.png]]

```
poetry install
```

```
poetry lock
```

![[Pasted image 20250221162850.png]]

```
poetry env activate
C:\Users\admin\Desktop\dev\dify\api\.venv\Scripts\activate.bat
```

```
flask db upgrade
```

```
(dify-api-py3.12) C:\Users\admin\Desktop\dev\dify\api>flask db upgrade

INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
INFO  [alembic.runtime.migration] Running upgrade  -> 64b051264f32, init
INFO  [alembic.runtime.migration] Running upgrade 64b051264f32 -> 9f4e3427ea84, add created by role
.......
```

```
flask run --host 0.0.0.0 --port=5001 --debug
```

