![[Pasted image 20250220172234.png]]

我们计划从这里去寻找账号和租户之间的关系。

我们先来看这里的添加按钮，通过对网络的监听，我们发现该按钮绑定的是下述的接口：

![[Pasted image 20250220172407.png]]




租户和账号之间的关系，账号和租户之间的关系实际上是多对多的关系，具体来说就是：租户是一个组织或团队，可以拥有多个成员（账户），然后一个账户可以属于多个租户。目前我们魔改的逻辑是这样，每次邀请创建一个账户，我们就会给它创建一个工作空间。一个租户对应一个工作空间。

工作空间和租户和账户之间的关系？




之前的逻辑是，用户邀请用户注册，在邀请的时候实际上就完成了账户的创建，且这个账户的状态是 PENDING，然后如果系统是允许创建工作空间的，就会为这个账户创建一个租户，然后为这个租户创建一个成员，也就是当前的账户，然后默认这个账户是当前这个租户的所有者。这个时候，实际上这个账户关联了两个租户，在其中一个租户中是使用者，在另一个中是所有者。所以也就呈现了我们在创建完一个用户之后，登录，在 apps 页面上可以看见他老东家和自己的工作空间（这是因为 /workspace 接口在列出工作空间的逻辑是直接用 account_id 去账户租户关联表里去捞所有和当前账户关联的租户），但是老东家却看不见自己下面用户的工作空间的原因。

这个状态应该可以通过改写 /workspace 接口里面的 sql 去进行解决。

首先明确一下需求是什么？？？

目前对这方面的源码刨析已经差不多了我觉得。我们是要实现什么？是让最开始的账户是最高权限这样吗？他可以看到所有他创建的用户的工作空间，然后用户看不到创建人的工作空间。