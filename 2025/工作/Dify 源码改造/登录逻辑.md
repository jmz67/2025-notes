
å½“æˆ‘ä»¬æ¸²æŸ“è¿›å…¥ signin é¡µé¢çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šå…ˆä»å» URL ä¸­å°†å‚æ•°æå–å‡ºæ¥ï¼Œç„¶åä½¿ç”¨ decodeURIComponent å°†å‚æ•°ä¸­é™„å¸¦çš„è¿™äº› token æå–å‡ºæ¥ã€‚

```jsx
import useSearchParams from "next/navigation"

const searchParams = useSearchParams();

// ä» URL æŸ¥è¯¢å‚æ•°ä¸­è·å–ç›¸å…³å€¼ï¼Œå¹¶è¿›è¡Œè§£ç 
const consoleToken = decodeURIComponent(searchParams.get('access_token') || '')
const refreshToken = decodeURIComponent(searchParams.get('refresh_token') || '')
const message = decodeURIComponent(searchParams.get('message') || '')
const invite_token = decodeURIComponent(searchParams.get('invite_token') || '')

```

åœ¨æå–åˆ°è¿™äº› token ä¹‹åï¼Œæˆ‘ä»¬ä¼šå»éªŒè¯æ˜¯å¦åŒæ—¶åŒ…å«ä¸¤ä¸ªå¿…è¦çš„ token ï¼Œå¦‚æœéƒ½æœ‰æˆ‘ä»¬å°±ä¼šå°†ä»–ä»¬å­˜å…¥ cookie ä¸­ï¼Œç„¶åè·³è½¬è¿›å…¥ apps é¡µé¢ã€‚è¿™ç§æƒ…å†µæˆ‘æ„Ÿè§‰ä¸€èˆ¬ç”¨äºç”¨æˆ·å·²ç»ç™»å½•äº†ï¼Œç„¶åå°†å¤±è¯¯æ“ä½œå›åˆ°äº†ç™»å½•ç•Œé¢ã€‚æˆ‘ä»¬çš„ç™»å½•ç•Œé¢è¿™ä¸ªæ—¶å€™ä¼šé‡æ–°è·å–ä¸€éç”¨æˆ·çš„ token çŠ¶æ€ç„¶åå†ä¿å­˜èµ·æ¥ã€‚

ç„¶åå°±æ˜¯ä¸€ç³»åˆ—çš„éªŒè¯ç³»ç»Ÿè®¾ç½®é‡Œé¢è®¾ç½®çš„ç™»å½•æ“ä½œæ˜¯ä»€ä¹ˆï¼Œè¿™é‡Œæˆ‘ä»¬åªå°†é»˜è®¤çš„é‚®ä»¶å’Œå¯†ç ç™»å½•è¡¨å•ç»„ä»¶ã€‚åœ¨è¿™ä¸ªç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬ç»ˆäºçœ‹åˆ°äº†åœ¨æµè§ˆå™¨ä¸Šçœ‹åˆ°çš„è¿˜æœªç™»å½•çš„æ—¶å€™å°±æœ‰çš„ä¸€ä¸ª token locale 

![[Pasted image 20250219232606.png]]

```jsx
import {useContext} from 'use-context-selector'

const { locale } = useContext(I18NContext)
```

ä½†æ˜¯å¾ˆé—æ†¾ï¼Œæˆ‘å¥½åƒæ²¡æœ‰çœ‹åˆ°å“ªé‡Œæœ‰ localStorage å»å°†å®ƒä¿å­˜åœ¨ cookie ä¸­ï¼Œåœ¨è¿™é‡Œå®ƒçš„ä½œç”¨åªæ˜¯å°†å®ƒæ‰“åŒ…åœ¨ data é‡Œé¢ä¸€å¹¶å‘ç»™ login è·¯ç”±è¯·æ±‚åç«¯ã€‚

```jsx
const loginData: Record<string, any> = {
    email,
    password,
    language: locale,
    remeber_me: true,
}

if (isInvite)
    loginData.invite_token = decodeURIComponent(searchParams.get('invite_token') as string)

const res = await login({
    url: '/login',
    body: loginData,
})
```

æˆ‘ä»¬æ¥çœ‹çœ‹åç«¯çš„ä»£ç æ˜¯æ€ä¹ˆå¤„ç†è¿™äº›è¾“å…¥æ•°æ®çš„ï¼š

```python
class LoginApi(Resource):
	"""Resource for user login."""

	@setup_required
	def post(self):
		"""Authenticate user and login."""

		# åˆ›å»ºè¯·æ±‚è§£æå™¨ï¼Œç”¨äºè§£æè¯·æ±‚ä¸­çš„å‚æ•°
		parser = RequestParser()

		# æ·»åŠ è¯·æ±‚å‚æ•°åŠå…¶éªŒè¯è§„åˆ™
		parser.add_argument("email", type=email, required=True, location="json") 
		# éªŒè¯é‚®ç®±æ ¼å¼

		parser.add_argument("password", type=valid_password, required=True, location="json")
		# éªŒè¯å¯†ç æ ¼å¼

		parser.add_argument("remember_me", type=bool, required=False, default=False, location="json")  
		# æ˜¯å¦è®°ä½ç™»å½•
        
        parser.add_argument("invite_token", type=str, required=False, default=None, location="json")  
        # é‚€è¯·ä»¤ç‰Œ
        
        parser.add_argument("language", type=str, required=False, default="en-US", location="json")  
        # ç”¨æˆ·è¯­è¨€

        args = parser.parser_args()
        # è§£æè¯·æ±‚å‚æ•°

        # å¦‚æœè®¡è´¹åŠŸèƒ½å¯ç”¨ä¸”ç”¨æˆ·é‚®ç®±è¢«å†»ç»“ï¼ŒæŠ›å‡ºå¼‚å¸¸
        if dify_config.BILLING_ENABLED and BillingService.is_email_in_freeze(args["email"]):
        	raise AccountInFreezeError()

        # æ£€æŸ¥æ˜¯å¦è¾¾åˆ°ç™»å½•é”™è¯¯é™åˆ¶
        is_login_error_rate_limit = AccountService.is_login_error_rate_limit(args["email"])
        if is_login_error_rate_limit:
            raise EmailPasswordLoginLimitError()

        # è·å–é‚€è¯·ä»¤ç‰Œ
        invitation = args["invite_token"]
        if invitation:
        	# éªŒè¯é‚€è¯·ä»¤ç‰Œæ˜¯å¦æœ‰æ•ˆ
        	invitation = RegisterService.get_invitation_if_token_valid(None, args[email], inviation)

       	if args["language"] is not None and args["langugae"] == "zh-Hans":
       		language = "zh-Hans"
       	else:
       		language = "en-US"

       	# å°è¯•éªŒè¯ç”¨æˆ·èº«ä»½
       	try:
       		if invitation:
       			# å¦‚æœæœ‰é‚€è¯·ä»¤ç‰Œï¼ŒéªŒè¯é‚€è¯·ä¿¡æ¯
       			data = invitation.get("data", {})
       			invitee_email = data.get("email") if data else None
       			if invitee_email != args["email"]:
       				raise InvalidEmailError()

       			# ä½¿ç”¨é‚€è¯·ä»¤ç‰Œè¿›è¡Œèº«ä»½éªŒè¯
       			account = AccountService.authenticate(args["email"], args["password"])

       		else:
       			# æ²¡æœ‰é‚€è¯·ä»¤ç‰Œï¼Œæ­£å¸¸éªŒè¯ç”¨æˆ·
       			account = AccountService.authenticate(args["email"], args["password"])

       	except services.errors.account.AccountLoginError:
       		# å¦‚æœè´¦æˆ·è¢«ç¦ç”¨ï¼ŒæŠ›å‡ºå¼‚å¸¸
            raise AccountBannedError()
        except services.errors.account.AccountPasswordError:
            # å¦‚æœå¯†ç é”™è¯¯ï¼Œè®°å½•é”™è¯¯æ¬¡æ•°å¹¶æŠ›å‡ºå¼‚å¸¸
            AccountService.add_login_error_rate_limit(args["email"])
            raise EmailOrPasswordMismatchError()
  		except services.errors.account.AccountNotFoundError:
            # å¦‚æœè´¦æˆ·æœªæ‰¾åˆ°
            if FeatureService.get_system_features().is_allow_register:
                # å¦‚æœå…è®¸æ³¨å†Œï¼Œå‘é€é‡ç½®å¯†ç é‚®ä»¶
                token = AccountService.send_reset_password_email(email=args["email"], language=language)
                return {"result": "fail", "data": token, "code": "account_not_found"}
            else:
                # å¦‚æœä¸å…è®¸æ³¨å†Œï¼ŒæŠ›å‡ºå¼‚å¸¸
                raise AccountNotFound()      

        # è·å–ç”¨æˆ·æ‰€å±çš„ç§Ÿæˆ·ä¿¡æ¯
        tenants = TenantService.get_join_tenants(account)
        if len(tenants) == 0:
            # å¦‚æœæ²¡æœ‰ç§Ÿæˆ·ä¿¡æ¯ï¼Œè¿”å›å¤±è´¥æç¤º
            return {
                "result": "fail",
                "data": "workspace not found, please contact system admin to invite you to join in a workspace",
            }

        # ç”¨æˆ·ç™»å½•æˆåŠŸï¼Œç”Ÿæˆç™»å½•ä»¤ç‰Œ
        token_pair = AccountService.login(account=account, ip_address=extract_remote_ip(request))
        # é‡ç½®ç™»å½•é”™è¯¯æ¬¡æ•°
        AccountService.reset_login_error_rate_limit(args["email"])
        # è¿”å›ç™»å½•æˆåŠŸçš„ç»“æœ
        return {"result": "success", "data": token_pair.model_dump()}
```




```jsx
import React, { useCallback, useEffect, useState } from 'react'  // å¼•å…¥ React å’Œç›¸å…³ hooks
import { useTranslation } from 'react-i18next'  // ç”¨äºå¤šè¯­è¨€ç¿»è¯‘
import Link from 'next/link'  // ç”¨äº Next.js çš„é“¾æ¥ç»„ä»¶
import { useRouter, useSearchParams } from 'next/navigation'  // Next.js è·¯ç”±ç›¸å…³åŠŸèƒ½
import { RiContractLine, RiDoorLockLine, RiErrorWarningFill } from '@remixicon/react'  // å¼•å…¥å›¾æ ‡ç»„ä»¶
import Loading from '../components/base/loading'  // å¼•å…¥ Loading ç»„ä»¶
import MailAndCodeAuth from './components/mail-and-code-auth'  // å¼•å…¥é‚®ç®±éªŒè¯ç ç™»å½•ç»„ä»¶
import MailAndPasswordAuth from './components/mail-and-password-auth'  // å¼•å…¥é‚®ç®±å¯†ç ç™»å½•ç»„ä»¶
import SocialAuth from './components/social-auth'  // å¼•å…¥ç¤¾äº¤è´¦å·ç™»å½•ç»„ä»¶
import SSOAuth from './components/sso-auth'  // å¼•å…¥å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰ç»„ä»¶
import cn from '@/utils/classnames'  // å¼•å…¥åŠ¨æ€ç±»åå·¥å…·
import { getSystemFeatures, invitationCheck } from '@/service/common'  // å¼•å…¥è·å–ç³»ç»ŸåŠŸèƒ½å’Œé‚€è¯·éªŒè¯çš„æœåŠ¡
import { LicenseStatus, defaultSystemFeatures } from '@/types/feature'  // å¼•å…¥è®¸å¯è¯çŠ¶æ€å’Œé»˜è®¤ç³»ç»ŸåŠŸèƒ½
import Toast from '@/app/components/base/toast'  // å¼•å…¥ Toast æ¶ˆæ¯ç»„ä»¶
import { IS_CE_EDITION } from '@/config'  // å¼•å…¥æ˜¯å¦ä¸ºä¼ä¸šç‰ˆçš„é…ç½®

const NormalForm = () => {  // ç™»å½•è¡¨å•ç»„ä»¶

  const { t } = useTranslation()  // è·å–ç¿»è¯‘åŠŸèƒ½
  const router = useRouter()  // è·å–è·¯ç”±å®ä¾‹
  const searchParams = useSearchParams()  // è·å– URL ä¸­çš„æŸ¥è¯¢å‚æ•°

  // ä» URL æŸ¥è¯¢å‚æ•°ä¸­è·å–ç›¸å…³å€¼ï¼Œå¹¶è¿›è¡Œè§£ç 
  const consoleToken = decodeURIComponent(searchParams.get('access_token') || '')
  const refreshToken = decodeURIComponent(searchParams.get('refresh_token') || '')
  const message = decodeURIComponent(searchParams.get('message') || '')
  const invite_token = decodeURIComponent(searchParams.get('invite_token') || '')

  // å®šä¹‰ä¸€äº› UI çŠ¶æ€
  const [isLoading, setIsLoading] = useState(true)  // æ§åˆ¶åŠ è½½çŠ¶æ€
  const [systemFeatures, setSystemFeatures] = useState(defaultSystemFeatures)  // å­˜å‚¨ç³»ç»ŸåŠŸèƒ½é…ç½®
  const [authType, updateAuthType] = useState<'code' | 'password'>('password')  // æ§åˆ¶å½“å‰çš„è®¤è¯æ–¹å¼
  const [showORLine, setShowORLine] = useState(false)  // æ§åˆ¶æ˜¯å¦æ˜¾ç¤º OR åˆ†éš”çº¿
  const [allMethodsAreDisabled, setAllMethodsAreDisabled] = useState(false)  // æ§åˆ¶æ˜¯å¦ç¦ç”¨æ‰€æœ‰è®¤è¯æ–¹æ³•
  const [workspaceName, setWorkSpaceName] = useState('')  // å­˜å‚¨å·¥ä½œåŒºåç§°

  // åˆ¤æ–­æ˜¯å¦ä¸ºé‚€è¯·é“¾æ¥
  const isInviteLink = Boolean(invite_token && invite_token !== 'null')

  // åˆå§‹åŒ–å‡½æ•°
  const init = useCallback(async () => {  // ä½¿ç”¨ useCallback ç¡®ä¿å‡½æ•°ä¸åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½é‡æ–°å®šä¹‰
    try {
      // å¦‚æœ URL ä¸­åŒ…å« access_token å’Œ refresh_tokenï¼Œåˆ™ç›´æ¥å­˜å‚¨å¹¶è·³è½¬
      if (consoleToken && refreshToken) {
        localStorage.setItem('console_token', consoleToken)  // ä¿å­˜ console_token åˆ° localStorage
        localStorage.setItem('refresh_token', refreshToken)  // ä¿å­˜ refresh_token åˆ° localStorage
        router.replace('/apps')  // é‡å®šå‘åˆ° /apps é¡µé¢
        return
      }

      // å¦‚æœ URL ä¸­åŒ…å« messageï¼Œæ˜¾ç¤ºé”™è¯¯æç¤º
      if (message) {
        Toast.notify({
          type: 'error',
          message,
        })
      }

      // è·å–ç³»ç»ŸåŠŸèƒ½é…ç½®
      const features = await getSystemFeatures()
      const allFeatures = { ...defaultSystemFeatures, ...features }  // åˆå¹¶é»˜è®¤åŠŸèƒ½å’Œè·å–åˆ°çš„åŠŸèƒ½
      setSystemFeatures(allFeatures)  // æ›´æ–°ç³»ç»ŸåŠŸèƒ½çŠ¶æ€
      // åˆ¤æ–­æ˜¯å¦ç¦ç”¨æ‰€æœ‰è®¤è¯æ–¹æ³•
      setAllMethodsAreDisabled(!allFeatures.enable_social_oauth_login && !allFeatures.enable_email_code_login && !allFeatures.enable_email_password_login && !allFeatures.sso_enforced_for_signin)
      // åˆ¤æ–­æ˜¯å¦æ˜¾ç¤º OR åˆ†éš”çº¿
      setShowORLine((allFeatures.enable_social_oauth_login || allFeatures.sso_enforced_for_signin) && (allFeatures.enable_email_code_login || allFeatures.enable_email_password_login))
      // æ ¹æ®æ˜¯å¦å…è®¸é‚®ç®±å¯†ç ç™»å½•æ¥è®¾ç½®é»˜è®¤è®¤è¯æ–¹å¼
      updateAuthType(allFeatures.enable_email_password_login ? 'password' : 'code')

      // å¦‚æœæ˜¯é‚€è¯·é“¾æ¥ï¼ŒéªŒè¯é‚€è¯·
      if (isInviteLink) {
        const checkRes = await invitationCheck({
          url: '/activate/check',
          params: {
            token: invite_token,
          },
        })
        setWorkSpaceName(checkRes?.data?.workspace_name || '')  // è·å–å¹¶è®¾ç½®å·¥ä½œåŒºåç§°
      }
    }
    catch (error) {
      console.error(error)  // æ‰“å°é”™è¯¯æ—¥å¿—
      setAllMethodsAreDisabled(true)  // å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œç¦ç”¨æ‰€æœ‰è®¤è¯æ–¹æ³•
      setSystemFeatures(defaultSystemFeatures)  // é‡ç½®ç³»ç»ŸåŠŸèƒ½ä¸ºé»˜è®¤å€¼
    }
    finally { 
      setIsLoading(false)  // æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼ŒåŠ è½½å®Œæˆ
    }
  }, [consoleToken, refreshToken, message, router, invite_token, isInviteLink])  // ä¾èµ–é¡¹ï¼šconsoleTokenã€refreshToken ç­‰

  useEffect(() => {  // ç»„ä»¶åŠ è½½æ—¶è°ƒç”¨åˆå§‹åŒ–å‡½æ•°
    init()
  }, [init])  // ä¾èµ–é¡¹ï¼šinit

  // å¦‚æœæ­£åœ¨åŠ è½½æˆ–è€…å·²ç»æœ‰æœ‰æ•ˆçš„ consoleTokenï¼Œæ˜¾ç¤º loading çŠ¶æ€
  if (isLoading || consoleToken) {
    return <div className={cn('flex flex-col items-center w-full grow justify-center', 'px-6', 'md:px-[108px]')}>
      <Loading type='area' />  {/* åŠ è½½åŠ¨ç”» */}
    </div>
  }

  // å¦‚æœè®¸å¯è¯çŠ¶æ€ä¸º LOSTï¼Œæ˜¾ç¤ºç›¸åº”æç¤º
  if (systemFeatures.license?.status === LicenseStatus.LOST) {
    return <div className='w-full mx-auto mt-8'>
      <div className='bg-white'>
        <div className="p-4 rounded-lg bg-gradient-to-r from-workflow-workflow-progress-bg-1 to-workflow-workflow-progress-bg-2">
          <div className='flex items-center justify-center w-10 h-10 rounded-xl bg-components-card-bg shadow shadows-shadow-lg mb-2 relative'>
            <RiContractLine className='w-5 h-5' />  {/* å›¾æ ‡ */}
            <RiErrorWarningFill className='absolute w-4 h-4 text-text-warning-secondary -top-1 -right-1' />  {/* é”™è¯¯æç¤ºå›¾æ ‡ */}
          </div>
          <p className='system-sm-medium text-text-primary'>{t('login.licenseLost')}</p>
          <p className='system-xs-regular text-text-tertiary mt-1'>{t('login.licenseLostTip')}</p>
        </div>
      </div>
    </div>
  }

  // å¦‚æœè®¸å¯è¯çŠ¶æ€ä¸º EXPIREDï¼Œæ˜¾ç¤ºç›¸åº”æç¤º
  if (systemFeatures.license?.status === LicenseStatus.EXPIRED) {
    return <div className='w-full mx-auto mt-8'>
      <div className='bg-white'>
        <div className="p-4 rounded-lg bg-gradient-to-r from-workflow-workflow-progress-bg-1 to-workflow-workflow-progress-bg-2">
          <div className='flex items-center justify-center w-10 h-10 rounded-xl bg-components-card-bg shadow shadows-shadow-lg mb-2 relative'>
            <RiContractLine className='w-5 h-5' />  {/* å›¾æ ‡ */}
            <RiErrorWarningFill className='absolute w-4 h-4 text-text-warning-secondary -top-1 -right-1' />  {/* é”™è¯¯æç¤ºå›¾æ ‡ */}
          </div>
          <p className='system-sm-medium text-text-primary'>{t('login.licenseExpired')}</p>
          <p className='system-xs-regular text-text-tertiary mt-1'>{t('login.licenseExpiredTip')}</p>
        </div>
      </div>
    </div>
  }

  // å¦‚æœè®¸å¯è¯çŠ¶æ€ä¸º INACTIVEï¼Œæ˜¾ç¤ºç›¸åº”æç¤º
  if (systemFeatures.license?.status === LicenseStatus.INACTIVE) {
    return <div className='w-full mx-auto mt-8'>
      <div className='bg-white'>
        <div className="p-4 rounded-lg bg-gradient-to-r from-workflow-workflow-progress-bg-1 to-workflow-workflow-progress-bg-2">
          <div className='flex items-center justify-center w-10 h-10 rounded-xl bg-components-card-bg shadow shadows-shadow-lg mb-2 relative'>
            <RiContractLine className='w-5 h-5' />  {/* å›¾æ ‡ */}
            <RiErrorWarningFill className='absolute w-4 h-4 text-text-warning-secondary -top-1 -right-1' />  {/* é”™è¯¯æç¤ºå›¾æ ‡ */}
          </div>
          <p className='system-sm-medium text-text-primary'>{t('login.licenseInactive')}</p>
          <p className='system-xs-regular text-text-tertiary mt-1'>{t('login.licenseInactiveTip')}</p>
        </div>
      </div>
    </div>
  }

  return (  // æ¸²æŸ“ç™»å½•è¡¨å•
    <>
      <div className="w-full mx-auto mt-8">
        {isInviteLink  // å¦‚æœæ˜¯é‚€è¯·é“¾æ¥ï¼Œæ˜¾ç¤ºå·¥ä½œåŒºç›¸å…³ä¿¡æ¯
          ? <div className="w-full mx-auto">
            <h2 className="title-4xl-semi-bold text-text-primary">{t('login.join')}{workspaceName}</h2>
            <p className='mt-2 body-md-regular text-text-tertiary'>{t('login.joinTipStart')}{workspaceName}{t('login.joinTipEnd')}</p>
          </div>
          : <div className="w-full mx-auto">
            <h2 className="title-4xl-semi-bold text-text-primary">{t('login.pageTitle')}</h2>
            <p className='mt-2 body-md-regular text-text-tertiary'>{t('login.welcome')}</p>
          </div>}
        <div className="bg-white">
          <div className="flex flex-col gap-3 mt-6">
            {systemFeatures.enable_social_oauth_login && <SocialAuth />}  {/* æ˜¾ç¤ºç¤¾äº¤ç™»å½•ç»„ä»¶ */}
            {systemFeatures.sso_enforced_for_signin && <div className='w-full'>
              <SSOAuth protocol={systemFeatures.sso_enforced_for_signin_protocol} />  {/* æ˜¾ç¤º SSO ç™»å½•ç»„ä»¶ */}
            </div>}
          </div>

          {showORLine && <div className="relative mt-6">
            <div className="absolute inset-0 flex items-center" aria-hidden="true">
              <div className='bg-gradient-to-r from-background-gradient-mask-transparent via-divider-regular to-background-gradient-mask-transparent h-px w-full'></div>
            </div>
            <div className="relative flex justify-center">
              <span className="px-2 text-text-tertiary system-xs-medium-uppercase bg-white">{t('login.or')}</span>
            </div>
          </div>}
          {
            (systemFeatures.enable_email_code_login || systemFeatures.enable_email_password_login) && <>
              {systemFeatures.enable_email_code_login && authType === 'code' && <>
                <MailAndCodeAuth isInvite={isInviteLink} />  {/* æ˜¾ç¤ºé‚®ç®±éªŒè¯ç ç™»å½•ç»„ä»¶ */}
                {systemFeatures.enable_email_password_login && <div className='cursor-pointer py-1 text-center' onClick={() => { updateAuthType('password') }}>
                  <span className='system-xs-medium text-components-button-secondary-accent-text'>{t('login.usePassword')}</span>
                </div>}
              </>}
              {systemFeatures.enable_email_password_login && authType === 'password' && <>
                <MailAndPasswordAuth isInvite={isInviteLink} isEmailSetup={systemFeatures.is_email_setup} allowRegistration={systemFeatures.is_allow_register} />  {/* æ˜¾ç¤ºé‚®ç®±å¯†ç ç™»å½•ç»„ä»¶ */}
                {systemFeatures.enable_email_code_login && <div className='cursor-pointer py-1 text-center' onClick={() => { updateAuthType('code') }}>
                  <span className='system-xs-medium text-components-button-secondary-accent-text'>{t('login.useVerificationCode')}</span>
                </div>}
              </>}
            </>
          }
          
          {/* å¦‚æœæ²¡æœ‰å¯ç”¨çš„ç™»å½•æ–¹æ³•ï¼Œåˆ™æ˜¾ç¤ºæç¤º */}
        </div>
      </div>
    </>
  )
}

export default NormalForm  // å¯¼å‡ºç™»å½•è¡¨å•ç»„ä»¶
```


```jsx
// å¯¼å…¥ Next.js çš„ Link ç»„ä»¶ï¼Œç”¨äºé¡µé¢è·³è½¬
import Link from 'next/link';
// å¯¼å…¥ React çš„ useState é’©å­ï¼Œç”¨äºç®¡ç†ç»„ä»¶çŠ¶æ€
import { useState } from 'react';
// å¯¼å…¥ react-i18next çš„ useTranslation é’©å­ï¼Œç”¨äºå›½é™…åŒ–ç¿»è¯‘
import { useTranslation } from 'react-i18next';
// å¯¼å…¥ Next.js çš„ useRouter å’Œ useSearchParams é’©å­ï¼Œç”¨äºè·¯ç”±æ“ä½œå’Œè·å–æŸ¥è¯¢å‚æ•°
import { useRouter, useSearchParams } from 'next/navigation';
// å¯¼å…¥ useContext é’©å­ï¼Œç”¨äºè®¿é—®ä¸Šä¸‹æ–‡
import { useContext } from 'use-context-selector';
// å¯¼å…¥ Button ç»„ä»¶ï¼Œç”¨äºåˆ›å»ºæŒ‰é’®
import Button from '@/app/components/base/button';
// å¯¼å…¥ Toast ç»„ä»¶ï¼Œç”¨äºæ˜¾ç¤ºæç¤ºä¿¡æ¯
import Toast from '@/app/components/base/toast';
// å¯¼å…¥ emailRegexï¼Œç”¨äºéªŒè¯ç”µå­é‚®ä»¶æ ¼å¼
import { emailRegex } from '@/config';
// å¯¼å…¥ login å‡½æ•°ï¼Œç”¨äºæ‰§è¡Œç™»å½•æ“ä½œ
import { login } from '@/service/common';
// å¯¼å…¥ Input ç»„ä»¶ï¼Œç”¨äºåˆ›å»ºè¾“å…¥æ¡†
import Input from '@/app/components/base/input';
// å¯¼å…¥ I18NContextï¼Œç”¨äºè®¿é—®å›½é™…åŒ–ä¸Šä¸‹æ–‡
import I18NContext from '@/context/i18n';

// å®šä¹‰å¯†ç æ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨äºéªŒè¯å¯†ç æ ¼å¼
const passwordRegex = /^(?=.*[a-zA-Z])(?=.*\d).{8,}$/;

// å®šä¹‰ç»„ä»¶çš„å±æ€§ç±»å‹
type MailAndPasswordAuthProps = {
    isInvite: boolean; // æ˜¯å¦é‚€è¯·ç™»å½•
    isEmailSetup: booleanï¼› // æ˜¯å¦å·²è®¾ç½®ç”µå­é‚®ä»¶
    allowRegisteration: boolean; // æ˜¯å¦å…è®¸æ³¨å†Œ
}

// å®šä¹‰ç»„ä»¶ï¼Œæ¥æ”¶ isInvite, isEmailSetup å’Œ allowRegisteration å±æ€§
export default function MailAndPasswordAuth({ isInvite, isEmailSetup, allowRegisteration }: MailAndPasswordAuthProps) {
    // ä½¿ç”¨ useTranslation é’©å­è·å–ç¿»è¯‘å‡½æ•°
    const { t } = useTranslation();

    // ä½¿ç”¨ useContext é’©å­è®¿é—®å›½é™…ä¸Šä¸‹æ–‡ï¼Œè·å–å½“å‰è¯­è¨€
    const { locale } = useContext(I18NContext);

    // ä½¿ç”¨ useRouter é’©å­è·å–è·¯ç”±å¯¹è±¡
    const router = useRouter();

    // ä½¿ç”¨ useSearchParams é’©å­è·å–æŸ¥è¯¢å‚æ•°
    const searchParams = useSearchParams();

    // å®šä¹‰æ˜¯å¦æ˜¾ç¤ºå¯†ç çš„çŠ¶æ€ï¼Œå¹¶æä¾›æ›´æ–°å‡½æ•°
    const [showPassword, setShowPassword] = useState(false);

    // ä»æŸ¥è¯¢å‚æ•°ä¸­è·å–ç”µå­é‚®ä»¶åœ°å€ï¼Œå¹¶è¿›è¡Œè§£ç 
    const emailFromLink = decodeURIComponent(searchParams.get('email') || '')

    // å®šä¹‰ç”µå­é‚®ä»¶çŠ¶æ€ï¼Œå¹¶æä¾›æ›´æ–°å‡½æ•°ï¼Œåˆå§‹å€¼ä¸ºä»é“¾æ¥ä¸­è·å–çš„ç”µå­é‚®ä»¶
    const [email, setEmail] = useState(emailFromLink)

    // å®šä¹‰å¯†ç çŠ¶æ€ï¼Œå¹¶æä¾›æ›´æ–°å‡½æ•°
    const [password, setPassword] = useState('')

    // å®šä¹‰åŠ è½½çŠ¶æ€ï¼Œå¹¶æä¾›æ›´æ–°å‡½æ•°
    const [isLoading, setIsLoading] = useState(false);

    // å®šä¹‰å¤„ç†ç”µå­é‚®ä»¶å’Œå¯†ç ç™»å½•å‡½æ•°
    const handleEmailPasswordLogin = async() => {
        // å¦‚æœç”µå­é‚®ä»¶ä¸ºç©ºï¼Œæ˜¾ç¤ºé”™è¯¯å¹¶è¿”å›
        if (!email) {
            Toast.notify({
                type: 'error',
                message: t('login.error.emailEmpty')
            });
            return;
        }
        // å¦‚æœç”µå­é‚®ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼Œæ˜¾ç¤ºé”™è¯¯æç¤ºå¹¶è¿”å›
        if (!emailRegex.test(email)) {
            Toast.notify({
                type: 'error',
                message: t('login.error.emailInValid'),
            });
            return;
        }

        // å¦‚æœå¯†ç ä¸ºç©ºï¼Œæ˜¾ç¤ºé”™è¯¯æç¤ºå¹¶è¿”å›
        if (!password?.trim()) {
            Toast.notify({
                type: 'error',
                message: t('login.error.passwordEmpty')
            });
            return;
        }

        try {
            // è®¾ç½®åŠ è½½çŠ¶æ€ä¸º true
            setIsLoading(true);
            // æ„é€ ç™»å½•æ•°æ®ï¼ŒåŒ…æ‹¬ç”µå­é‚®ä»¶ï¼Œå¯†ç ï¼Œè¯­è¨€å’Œæ˜¯å¦è®°ä½ç™»å½•çŠ¶æ€
            const loginData: Record<string, any> = {
                email, password, language: locale, remeber_me: true,
            };
            // å¦‚æœæ˜¯é‚€è¯·ç™»å½•ï¼Œæ·»åŠ é‚€è¯·ä»¤ç‰Œ
            if (isInvite)
                loginData.invite_token = decodeURIComponent(searchParams.get('invite_token') as string);
            // è°ƒç”¨ç™»å½•å‡½æ•°ï¼Œå‘é€ç™»å½•è¯·æ±‚
            const res = await login({
                url: '/login',
                body: loginData,
            });
            // å¦‚æœç™»å½•æˆåŠŸ
            if(res.result === 'sucess') {
                // å¦‚æœæ˜¯é‚€è¯·ç™»å½•ï¼Œè·³è½¬åˆ°é‚€è¯·è®¾ç½®é¡µé¢
                if (isInvite) {
                    router.replace(`/signin/invite-settings?${searchParams.toString()}`);
                }
                // å¦‚æœä¸æ˜¯é‚€è¯·ç™»å½•ï¼Œä¿å­˜ä»¤ç‰Œå¹¶è·³è½¬åˆ°åº”ç”¨é¡µé¢
                else {
                    // localStorage æ˜¯ä¸€ä¸ª webapi ç”¨äºåœ¨æµè§ˆå™¨ä¸­å­˜å‚¨æ•°æ®
                    // åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€šè¿‡è¿™ä¸ª api ä¿å­˜ä»¤ç‰Œ
                    localStorage.setItem('console_token', res.data.access_token); // ä¿å­˜è®¿é—®ä»¤ç‰Œ
                    localStorage.setItem('refresh_token', res.data.refresh_token); // ä¿å­˜åˆ·æ–°
                    router.replace('/apps');
                }
            }

            // å¦‚æœè´¦æˆ·æ²¡æœ‰è¢«æ‰¾åˆ°
            else if (res.code === 'account_not_found') {
                // å¦‚æœå…è®¸æ³¨å†Œï¼ŒåŒ…å«ç”µå­é‚®ä»¶å’Œä»¤ç‰Œ
                const params = new URLSearchParams();
                params.append('email', encodeURIComponent(email));
                params.append('token', encodeURIComponent(res.data));

                // è·³è½¬åˆ°é‡ç½®å¯†ç é¡µé¢
                router.replace(`/reset-password/check-code?${params.toString()}`)
            }

            // å¦‚æœä¸å…è®¸æ³¨å†Œï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
            else {
                Toast.notify({
                    type: 'error',
                    message: t('login.error.registrationNotAllowed'),
                });
            }
        }
        // å…¶ä»–é”™è¯¯æƒ…å†µï¼Œæ˜¾ç¤ºé”™è¯¯æç¤º
        else {
            Toast.notify({
                type: 'error',
                message: res.data,
            });
        }
        finally {
            setIsLoading(false);
        }
    };

    return 

    <form onSubmit={() => { }}>
        <div className="mb-3">
            <label htmlFor="email" className="my-2 system-md-semibold text-text-secondary">
                {t('login.email')}
            </label>
            <div className="mt-1">
                <Input
                    value={email}
                    onChange={e => setEmail(e.target.value)}
                    disabled={isInvite} // å¦‚æœæ˜¯é‚€è¯·ç™»å½•ï¼Œç¦ç”¨è¾“å…¥æ¡†
                    id="email"
                    type="email"
                    autoComplete="email"
                    placeholder={t('login.emailPlaceholder') || ''} // æ˜¾ç¤ºç”µå­é‚®ä»¶å ä½ç¬¦
                    tabIndex={1}
                />
            </div>
        </div>

        <div className='mb-3'>
          <label htmlFor="password" className="my-2 flex items-center justify-between">
            <span className='system-md-semibold text-text-secondary'>{t('login.password')}</span> // æ˜¾ç¤ºå¯†ç æ ‡ç­¾
            <Link
              href={`/reset-password?${searchParams.toString()}`} // é“¾æ¥åˆ°é‡ç½®å¯†ç é¡µé¢
              className={`system-xs-regular ${isEmailSetup ? 'text-components-button-secondary-accent-text' : 'text-components-button-secondary-accent-text-disabled pointer-events-none'}`}
              tabIndex={isEmailSetup ? 0 : -1}
              aria-disabled={!isEmailSetup}
            >
              {t('login.forget')}
            </Link>
          </label>
          <div className="relative mt-1">
            <Input
              id="password"
              value={password} // ç»‘å®šå¯†ç å€¼
              onChange={e => setPassword(e.target.value)} // æ›´æ–°å¯†ç å€¼
              onKeyDown={(e) => {
                if (e.key === 'Enter') // å¦‚æœæŒ‰ä¸‹å›è½¦é”®ï¼Œè°ƒç”¨ç™»å½•å‡½æ•°
                  handleEmailPasswordLogin()
              }}
              type={showPassword ? 'text' : 'password'} // æ ¹æ®çŠ¶æ€æ˜¾ç¤ºå¯†ç æˆ–éšè—å¯†ç 
              autoComplete="current-password"
              placeholder={t('login.passwordPlaceholder') || ''} // æ˜¾ç¤ºå¯†ç å ä½ç¬¦
              tabIndex={2}
            />
            <div className="absolute inset-y-0 right-0 flex items-center">
              <Button
                type="button"
                variant='ghost'
                onClick={() => setShowPassword(!showPassword)} // åˆ‡æ¢æ˜¾ç¤ºå¯†ç çŠ¶æ€
              >
                {showPassword ? 'ğŸ‘€' : 'ğŸ˜'} // æ˜¾ç¤ºå›¾æ ‡ï¼Œè¡¨ç¤ºæ˜¾ç¤ºæˆ–éšè—å¯†ç 
              </Button>
            </div>
          </div>
        </div>

        <div className='mb-2'>
          <Button
            tabIndex={2}
            variant='primary'
            onClick={handleEmailPasswordLogin} // ç‚¹å‡»æŒ‰é’®æ—¶è°ƒç”¨ç™»å½•å‡½æ•°
            disabled={isLoading || !email || !password} // å¦‚æœæ­£åœ¨åŠ è½½æˆ–è¾“å…¥ä¸ºç©ºï¼Œç¦ç”¨æŒ‰é’®
            className="w-full"
          >{t('login.signBtn')}</Button> 
        </div>
    </form>
}
```

